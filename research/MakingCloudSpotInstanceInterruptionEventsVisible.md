# Making Cloud Spot Instance Interruption Events Visible

https://dl.acm.org/doi/epdf/10.1145/3589334.3645548

## Abstruct
パブリッククラウドコンピューティングプロバイダーは、スポットインスタンスというサービスを通じて、余剰のコンピューティングリソースを低価格で提供しています。
スポットインスタンスの利用により大幅なコスト削減が期待できる一方で、リソース需要の変化に伴い、突発的なリソース中断が発生する可能性があります。
スポットインスタンス利用時のコスト削減効果と中断の可能性をユーザーが予測できるよう、ベンダーは多様なデータセットを提供しています。
しかし、データセット利用の有効性はまだ定量的に評価されておらず、多くのユーザーは依然としてスポットインスタンスの選択において推測に頼っています。
本稿では、ユーザーがスポットインスタンスの中断の可能性を低減し、信頼性の高い利用を実現できるよう支援するため、スポットインスタンスの様々なデータセットを徹底的に分析し、価値予測の実現可能性を示します。
次に、公開データセットが実際のスポットインスタンス中断事象をどのように反映しているかを測定するために、AWS、Azure、Google Cloudのスポットインスタンスを対象に実環境実験を実施します。
データセット分析、モデリング、そして実環境におけるスポットインスタンス中断実験を組み合わせることで、中断事象の可能性を大幅に低減できることを示します。

## Introduction
### スポットインスタンスについて
はじめにクラウドコンピューティングは、システム運用のオーバーヘッドを気にすることなく、コンピューティングリソースを弾力的に提供し、コンピューティングリソースの利用方法を変えます。クラウドコンピューティングの成功の鍵は、オンデマンド課金モデルにあります。このモデルでは、ユーザーはアプリケーションのニーズに応じてインスタンスを動的に起動・停止し、実際に使用した分だけ料金を支払うことができます。弾力的なリソース利用をサポートするために、クラウドサービスプロバイダーは、リソース使用量の急増に対応できるよう、十分なリソースを用意する必要があります。しかし、このように十分なリソースを用意すると、コンピューティング需要が低いときには必然的にリソースが無駄になります。需要が低いときにインスタンスの利用を促すため、パブリッククラウドベンダーは余剰コンピューティングリソースを割引価格で提供しています。場合によっては、オンデマンド価格よりも90%以上も安くなることもあります。この課金モデルはスポットインスタンスと呼ばれ、AWS [ 1]、Azure [54 ]、Google Cloud Platform (GCP) [ 18 ]、Alibaba [36]、OracleCloud Preemptible Instances、IBM Transient Virtual Servers など、ほとんどのパブリッククラウドサービスプロバイダーによって提供されています。スポットインスタンスの提供開始当初は、ほとんどのベンダーがオークション方式を採用しており、ユーザーが入札価格を設定し、プロバイダーがスポット価格を設定していました。入札価格がスポット価格よりも高かった場合、ユーザーにはインスタンスが付与され、入札価格ではなくスポット価格を支払います。コンピューティングリソースの需要に基づいて、サービスプロバイダーはスポット価格を変更し、スポット価格が最初の入札価格よりも高くなった場合、スポットインスタンスは取り消されます。これは一般にインスタンス中断と呼ばれます。このようなインスタンス中断はアプリケーションの信頼性に悪影響を及ぼす可能性があるため、ユーザーはこの事態に備える必要があります。スポットインスタンスを使用する際の信頼性向上をユーザーに示すため、クラウドベンダーはさまざまなデータセットを公開しています。最も代表的なデータセットの一つはスポットインスタンス価格で、これは特定の時間におけるスポット価格を示します。スポットインスタンス価格データセットを用いてスポット価格そのものを分析した研究 [1, 13, 21, 36, 51]、スポットインスタンスデータセットを用いて様々なアプリケーションの信頼性を高めた研究 [2, 11, 19, 30, 34, 43, 45, 49]、スポット価格予測を用いて最適な入札価格を提案した研究 [3, 15, 25, 26, 44, 60] など、多くの研究が行われてきました。
###　AWSスポットインスタンス運用ポリシーの変更
スポット価格データセットは、特にAWSにおいてスポットインスタンスを安定的に利用するための貴重な情報源でしたが、新しいスポットインスタンス運用ポリシーによってその内容は変化しています。
新しいポリシーでは、広告されるスポット価格はスポットインスタンスの中断を反映しなくなり、データの変更頻度は非常に低くなります[6, 20]。これにより、データセットの適用性が大幅に低下し、以前の研究結果が無効になります。
一方、スポットインスタンスの新しいデータセットがWeb上で公開され、ユーザーが信頼性の高いスポットインスタンスのリソースプールを構築できるようにしています[31]。新しいデータセットには、AzureとAWSが提供する前月の中断率と、AWSが提供する瞬間的な可用性情報が含まれています。これらの新しいデータセットは、過去の中断率と瞬間的な可用性情報を提供するため、スポットインスタンスユーザーにとって非常に役立ちます。しかし、新しく提供されたデータセットの徹底的な調査はまだ行われておらず、データセットとスポットインスタンスの中断の相関関係に関する定量的な評価はまだ行われていません。スポットインスタンスを主要なコンピューティングリソースプールとして導入する場合、突然のスポットインスタンスの中断は大きな障害となるため、少なくとも近い将来にスポットインスタンスが中断される可能性を予測することが重要です。しかし、クラウドサービスベンダーの視点以外では、中断イベントの詳細にアクセスできないため、将来のスポットインスタンスの中断を予測したり、中断動作の統計モデルを構築したりすることは非常に困難です。スポットインスタンスの中断イベントを定量的に評価およびモデル化するには、世界中のリージョンとアベイラビリティゾーンに配置されたさまざまなインスタンスタイプについて、中断イベントがいつ発生するかを把握する必要があります。サービスプロバイダーはそのような記録を保有している可能性がありますが、その情報は公開されていません。例えば、Yangら[54]は、Azureスポットインスタンスのスポットインスタンス中断予測モデルを提案しましたが、これは公開されていない中断記録の内部データセットを使用しており、公開されている研究成果の開発を制限しています。独自の情報なしにスポットインスタンスの中断イベントをモデル化するために、SciSpot[23]とPhamら[24]が研究を行いました。 [ 39 ]は、GCPとAWSそれぞれで、スポットインスタンスを中断が発生するまで実行することにより、スポットインスタンス中断イベントを観察する実際の実験を実施しました。中断イベントのログを収集した後でも、中断に関連する特徴を明らかにすることは困難な場合があります。AWSの場合、スポット価格は良い指標でしたが、運用ポリシーの変更後は有効ではなくなりました[6, 20]。スポットインスタンス中断イベントの予測とモデリングは、新しく再リースされたスポットインスタンスデータセットを使用しても困難であるという観察に基づいて、まず、AWS、Azure、およびGCPが提供するスポット価格、前期中断率、および即時可用性データセットの特性を分析します。公開データセットがスポットインスタンス中断の実際の動作を反映しているかどうかを検証し、複数のベンダーのスポットインスタンスの信頼性を比較するために、AWS、Azure、およびGCPのスポットインスタンス中断テストを実施しました。公開データセットの分析と実際のスポットインスタンス中断実験の結果に基づいて、スポットインスタンスの瞬時可用性データセットの値を正確に予測することで、スポットインスタンスの中断確率を低減し、その主張を定量的に確認できると主張します。 全体として、Azure スポットインスタンスが最も高い信頼性を示し、次いで GCP と AWS が続いたと結論付けました。 AWS は最も低い信頼性を示しましたが、AWS が提供するデータセットはスポットインスタンスの信頼性を推測する上で非常に役立つことがわかりました。 提案されたデータセット値予測子を使用すると、AWS の実行時間は、初期スコアが高いインスタンスでは 63.2%、初期スコアが低いインスタンスでは 168% 増加します。 ただし、データセットが限られている Azure と GCP では、AWS データセットの場合のように、提供されたデータセットとスポットインスタンスの信頼性の間に強い相関関係は見つかりませんでした。 まとめると、本論文の主な貢献は次のとおりです。
• AWS、Azure、および GCP の信頼性の比較。著者の知る限り、主要複数ベンダーのスポットインスタンスの信頼性を比較した研究はこれが初めてです。
• 価格、中断率、可用性を含むスポットインスタンスデータセットを徹底的に分析し、主にAWSにおけるスポットインスタンスの中断との相関関係を明らかにしました。
• スポットインスタンスデータセットの値を予測する際のシンプルなモデルの有効性を定量的に示しました。
• クラウドベンダーが独占的に保有する機密性の高い内部運用ログを使用することなく、中断率を低減するためのスポットインスタンスタイプを推奨するヒューリスティックを提案しました。

## CLOUD SPOT INSTANCE AND DATASETS
ポットインスタンスを利用する際、オンデマンドインスタンスに対するコスト削減率とスポットインスタンスの信頼性は、ほとんどのユーザーにとって最も重要な指標です。スポットインスタンス利用時のメリットとリスクをユーザーが予測できるよう、クラウドベンダーは様々なデータセットを提供しています。例えば、スポットインスタンスの利用開始時点の価格、​​最近の中断率、そして即時の可用性に関する情報などです。
### 価格データセットの減価償却
2009年のスポットインスタンスサービス導入以来、スポット価格データセットは公開されており、様々な観点から多くの研究が行われています。スポットインスタンス価格データセットの統計分析は、包括的な方法で行われてきました[1, 13, 15, 21, 33, 36, 40, 51, 52]。その他の研究では、インスタンス中断のリスクを軽減するために最適な入札価格を提案することに焦点を当てています [ 3 、 17 、 26 、 32 、 42 、 44 、 46 、 57 、 60 ]。別の種類の研究では、スポットインスタンスの価格データセットを使用して、Webサーバー [ 2]、ビッグデータ処理 [ 53 ]、ディープラーニングトレーニング [ 30 、 48 ] と推論 [ 59 ]、バッチ処理 [ 34 、 45 ]、科学的高性能コンピューティングアプリケーション [ 61] など、さまざまなアプリケーションをスポットインスタンスで確実に実行することに焦点を当てています。他の研究は、Azure [ 54 、 55 ]、GCP [ 18 、 23 ]、Alibaba Cloud [ 36 ] など、他のベンダーのデータセットを使用して実行されています。AWSスポットインスタンスとその価格データセットを使用して多くの研究が行われている理由の1つは、広告スポット価格と入札価格を比較することで、ユーザーは中断の可能性を容易に推測できます。しかし、スポットインスタンスの運用ポリシーが変更されたため、価格データセットを用いてスポットインスタンスの中断をモデル化することは不可能になりました[6, 20]。この変更により、スポット価格は以前ほど頻繁には変化しなくなりました。さらに重要なのは、スポット価格がインスタンスの中断を示すわけではないということです。広告スポット価格が入札価格よりも低い場合でも、中断は依然として発生する可能性があります。運用ポリシーの変更により、AWSスポットインスタンスは他のベンダーのスポットインスタンスと類似したものになり、スポット価格がめったに変化しないことが示唆され、スポット価格データセットに依存したこれまでの研究のほとんどが無意味になります。
### 可用性データセットの重要性 
スポットインスタンスの信頼性を推測する観点から、スポット価格データセットの有用性が低下するにつれ、サービスベンダーはインスタンスの可用性に関連する新しいタイプのデータセットの提供を開始しました。AWSとAzureは、過去30日間などのインスタンスの中断率を提供しています。データセットは、中断率を5%未満、5%〜10%、10%〜15%、15%〜20%、20%以上の5つのカテゴリに分類します。過去の中断率のデータセットを使用することで、ユーザーはスポットインスタンスの将来の信頼性を推測することが期待されます。単に過去期間の統計情報を提供する中断率データセットとは異なり、AWSはスポット配置スコア（SPS）と呼ばれる新しいデータセットを提供しています。ベンダーはスコアの計算方法に関する内部情報を公開していませんが、タイムリーなスポットインスタンスの可用性を示すことが知られています。 SPSでは、スポットインスタンスの種類ごとに1から3までの整数スコアが割り当てられ、スコアが高いほど可用性が高いことを意味します。アベイラビリティゾーン内の各インスタンスタイプには、固有のSPSが割り当てられます。ユーザーはAWSコンソールまたはAPIサービスを通じてデータセットにアクセスできますが、値のクエリには多くの制限があります。クエリ制限を解決するために、SpotLake [31]は多くのヒューリスティックを実装し、データセットを生のファイルとして提供しています。AzureとGCPは同様のデータセットを提供していないため、可用性データセットの分析はSPSのみに基づいて行われます。

## スポットインスタンスデータセットの分析
様々なスポットインスタンスデータセットの特性をより深く理解するために、SpotLake [29] が提供する公開スポットインスタンスデータセットの実証分析結果を示す。SpotLakeからは、AWS、Azure、GCPのスポット価格データセットをダウンロードできた。スポットインスタンス中断率データセットについては、AWSとAzureからデータセットを入手した。また、即時可用性情報については、AWS SPSデータセットを入手した。本分析では、2022年11月1日から2023年8月31日までのデータセットを使用した。図1は、複数のスポットインスタンスデータセットの値の累積分布関数（CDF）を示している。図 2a は、AWS、Azure、GCP の節約率 (1.0 − 𝑆𝑝𝑜𝑡𝑃𝑟𝑖𝑐𝑒𝑂𝑛−𝑑𝑒𝑚𝑎𝑛𝑑𝑃𝑟𝑖𝑐𝑒 ) × 100 を比較しています。図 2b は、AWS と Azure のインスタンス中断率を比較しています。両ベンダーとも 5 つのカテゴリの範囲でデータセットの値を提供しており、各カテゴリを 1.0 から 3.0 までの間で 0.5 ずつ増分した数値に対応させています。最も頻繁な中断率 (20% を超える) は 1.0 に対応し、最も頻繁な中断率 (5% 未満) は 3.0 に対応しています。変換した値は SpotLake [ 31 ] で提案された表記法に従い、割り込みフリースコアと名付ける。図 2c は AWS が提供するインスタント可用性データセットの分布を示している。スコア範囲が提供されている SPS データセットを使用している。ベンダーを区別するために、黄色の実線、青の点線、緑の破線でそれぞれ AWS、Azure、GCP を示している。図では、縦軸は分布を、横軸はスコアを示している。3 つのサブ図すべてにおいて、スコアが大きいほど信頼性の高い状態であることを意味する。図では、AWS のコスト削減が最も低く (図 2a)、スポットインスタンスの中断頻度が高い (図 2b) ことが明らかである。GCP は価格データセットのみを提供し、AWS よりも高いコスト削減率の中央値を示している。割り込みフリースコアに関しては、AWS の中央値スコアは約 2.5 で、中断率が 5% から 10% の間であるのに対し、Azure は約 3.0 で、5% 未満である。 AWS のみが即時可用性情報を提供しており、ほとんどのスポットインスタンスが最高スコアである 3.0 付近に割り当てられていることがわかります。図 2 は、各サブ図で収集されたすべてのインスタンスタイプについて平均された 3 つのスポットデータセットの経時変化のパターンを示しています。図 2a はスポットインスタンスの節約率を比較しており、ベンダーに関係なく、節約値は時間の経過とともにほとんど変化しないことがわかります。AWS スポットインスタンスの価格変更の頻度が低いことは、AWS スポットインスタンスの動作の最近の変化を分析した以前の研究と一致しています [6, 20]。図 2b は、割り込みフリースコアの経時変化のパターンを示しています。視覚的に顕著な変化パターンが存在するかどうかを確認するために、AWS と Azure のグラフを分離して、マイクロスケールで表示しました。コスト節約と同様に、AWS と Azure はどちらも時間の経過に伴う顕著な変化パターンを示しません。図 2c は、AWS SPS データセットの経時変化パターンを示しています。コスト削減と中断のデータセットとは異なり、SPSデータセットは異なる日に正弦波状の周期的なパターンを示しています。分析から、さらなる研究と分析を刺激する、SPSの変化の独特で顕著なパターンを明らかにすることができます。垂直軸の範囲はデータセットごとに異なることに注意してください。削減と中断なしのスコアのパターンを小規模で綿密に観察しましたが、SPSに類似したパターンは見つかりませんでした。SPS値の変化パターンをさらに分析するために、図3aは1日1時間の平均SPS値を示しています。分析では、世界中の複数のリージョンにあるリソースを使用し、各アベイラビリティゾーンのローカルタイムゾーンを使用しました。図から、SPSは午前中に低いことがわかります。その後、SPSは徐々に増加し、クラウド使用量が少ないと予想される夜間に最大に達します。SPS値の変化に週ごとのパターンがあるかどうかを確認するために、図3bは横軸に日ごとの平均SPS値を示しています。 SPSの値は週末に高く、平日に低いことがわかります。SPSの詳細な分析は付録に記載されています。スポット価格と中断率を分析しましたが、目立ったパターンは見られませんでした。AWS SPSデータセットでは、より頻繁で定期的なデータ更新パターンが見られました。スポットインスタンスデータセットの変更頻度をさらに分析するために、図4にデータ変更頻度のCDFを示します。縦軸は分布、横軸は値が変更されていない期間を示します。図の右側にある大きな値は、値がより長い期間変更されていないことを意味します。図には、すべてのデータセットの分布が示されています。その中で、黄色の実線と三角形のマーカーで示されているAWSSPSは、他のデータセットと比較して最も頻繁に更新されていることを示しています。
様々なスポットインスタンスデータセットの分析から、AzureとGCPのスポットインスタンスはAWSよりも比較的高いコスト削減効果を示していることがわかりました。AWSの中断率はAzureよりも高くなっています。AWS SPSのみが日次および時間ごとの変化パターンを示しています。AWS SPSの値は頻繁に変化しており、他のデータセットの変化頻度は1日以上です。

## 4 スポットデータセットの変化の予測
スポットインスタンスを使用する場合、将来の中断イベントの予測と確率の推定は、信頼性の向上に大いに役立ちます。目標を達成するには、中断イベントと相関する適切な機能を発見することが重要です。スポットインスタンスデータセットの分析により、価格と中断率の情報は時間の経過とともにほとんど変化しないのに対し、AWS SPS の瞬間可用性情報は頻繁かつ定期的に変化することがわかりました。スポットインスタンスの価格に関する最近の研究成果 [ 6 、 20 、 31 ] を考慮すると、スポット価格はスポットインスタンスの中断とほとんど相関がありません。スポットインスタンスの中断率は、過去 30 日間の中断統計を示しており、将来の可用性を予測するにはほど遠い可能性があります。この文脈では、正確な予測がスポットインスタンスの信頼性の向上に役立つことを期待して、インスタント可用性データセットを予測するモデルを提案し、これは後で評価されます。
### 4.1 インスタント可用性データセットのモデリングインスタント
可用性データセット予測モデルは、前の期間の SPS を入力特徴として使用し、将来の SPS 値を予測します。正式には、入力データセットと 𝑿 の特徴は、異なるアベイラビリティゾーン内の 𝑁 個の異なるインスタンスタイプ (提供される個別の SPS の単位) と、異なるタイムスタンプでの SPS 値を表す 𝐷 の特徴で構成されます。SPS データセットのデータ収集が 𝑝 分間隔で行われると仮定すると、前回収集された 𝐷 データセットをトレーニングに使用できます。つまり、最後の 𝐷 × 𝑝 分間に収集されたデータセットを使用します。同様に、予測するターゲットデータセットは 𝒀 として示され、𝑁 個の異なるインスタンスタイプと予測する次の 𝐾 個の SPS 値があります。 𝑥𝑖𝑑 （𝑖 = 1 : 𝑁、𝑑 = 1 : 𝐷）は、𝑖 番目のインスタンスタイプと𝑑 番目のインデックス SPS を意味し、𝑦𝑖𝑘 （𝑖 = 1 : 𝑁、𝑘 = 1 : 𝐾）は、𝑖 番目のインスタンスタイプと𝑘 番目のインデックス SPS を意味します。訓練データセットは以下のように定義されます。D ≜ {(𝑥𝑖𝑑 → 𝑦𝑖𝑘 )|(𝑥𝑖𝑑 , 𝑦𝑖𝑘 ) ∈ {1, 2, 3}} (1)𝑥𝑖𝑑 と𝑦𝑖𝑘 の各値は、{1, 2, 3}のいずれかのSPS値を取ります。訓練データセットを定義する際には、使用する過去の測定データセットの数（𝐷）と、予測する将来のデータセットの数（𝐾）を決定する必要があります。徹底的な実証分析により、𝐷と𝐾の選択は全体的な予測精度に大きな影響を与えないことが明らかになりました（付録の図11）。
### 4.2 可用性データセット予測子の精度式
1のトレーニングデータセットDを使用して、線形回帰器（LR）[37]、ランダムフォレスト（RF）分類器[8]、XGBoost [10]、サポートベクター分類器（SVC）[5]、Prophet [47]、およびARIMA [7]のさまざまな分類モデルを適用します。表1は、精度と再現率の両方を評価するために、さまざまな予測モデルのF1スコアを比較しています[41]。トレーニングでは、2023年7月16日から2023年7月31日までのSPSデータセットを使用しました。テストには、トレーニングデータセット期間のみの2023年8月1日から2023年8月6日までのデータセットを使用しました。テストデータセットを半分に分割し、前の半分の期間をモデル入力として使用します。次の半分のデータセットでは、予測期間𝑘を次の3、6、12、24、48、72時間に変更し、列に表示します。多くのモデルの中で、XGBoostは、将来予測ウィンドウのサイズに関係なく、わずかな差ではありますが、最高のパフォーマンスを示しています。予測モデルが異なっていても、予測パフォーマンスは非常に似ていることがわかります。調査により、多くの場合、SPS値は時間の経過とともに一定のままであることが明らかになり、予測が容易になります。SPS値が急激に変化した場合の予測パフォーマンスを比較するために、表2に、SPS値の変化頻度別に分類した予測パフォーマンスを示します。テストデータ期間中のSPS値の標準偏差が0.1、0.25、0.5、0.75より大きいインスタンスタイプを分類しました。テストデータ全体のうち、それぞれ14%、11%、6%、2%のケースが各カテゴリに属しています。SPSがより頻繁に変化する（0.75以上）場合、XGBoostが最も優れた予測性能を示したことがわかります。SPS予測を使用するには、学習や推論時間などの操作オーバーヘッドを理解することが重要です。付録の表4で操作オーバーヘッドを比較しました。予測性能と演算オーバーヘッドを考慮すると、XGBoostモデルを使用するのが最も理にかなっています。予測モデルを構築するときにSPS値の最新性の影響を分析するために、図5は構築されたXGBoostモデルから抽出された特徴の重要度を示しています。縦軸は各特徴の重要度を示し、横軸は時系列特徴のインデックスを示しています。インデックス番号が小さいほど、モデルをトレーニングしたときのデータセットが新しいことを意味します。たとえば、モデルが任意の時間𝑡に構築されたと仮定すると、インデックス1は時間単位𝑡−1で観測されたSPS値を意味します。図に示すように、最近のSPS値がモデルを支配しており、24時間までのSPS値が全体の重要度の79%を占めています

## 5 評価 
このセクションでは、スポットインスタンスの中断イベントを詳細に分析することにより、スポットインスタンスの信頼性を向上させるヒューリスティックの有効性を評価します。具体的には、以下の研究課題に回答します。
RQ-1 主要ベンダーが提供するスポットインスタンスのうち、中断に関して最も信頼性が高いベンダーはどれですか？
RQ-2 多くのスポットインスタンスデータセットのうち、スポットインスタンスの中断と最も相関性の高いデータセットはどれですか？
RQ-3 SPS値の予測によって、スポットインスタンスの中断の可能性を低減できますか？

### 5.1 スポットインスタンスの中断分析
まず、複数のクラウドベンダーの中断挙動を比較します（RQ-1）。中断イベントを調査するために、中断イベントが発生するまでスポットインスタンスを実行するという実世界実験を行いました。世界中に分散しているAWS、Azure、GCPから875種類のインスタンスを選択しました。任意のインスタンスタイプを選択する際には、コスト削減、中断率、および即時可用性データセットの異なる値が均等に分散されるようにしました。実験は2022年7月から2023年3月までの期間に、各インスタンスタイプごとに24時間実施されました。中断が発生すると、イベントをマークし、再びスポットインスタンスが満たされるまでそのイベントを要求し続けます。中断実験を実施するためのソースコードは成果物として共有しています[28]。スポットインスタンスの生存率、つまりスポットインスタンスが稼働し続ける確率を定量的に比較するために、生涯データセットの生存率を推定するノンパラメトリック統計であるカプラン・マイヤー推定量[24]を適用しました。これは一般的に病院環境で使用され、治療後に生存する人の割合や、失業後の失業期間を測定するために使用されます[35]。一般的な使用法を考慮すると、スポット インスタンスの生存確率をモデル化するためにこれを適用するのが適しています。Kaplan-Meier 推定量は次のように計算されます。b𝑆(𝑡) =Ö𝑖: 𝑡𝑖 ≤𝑡 𝑛𝑖 − 𝑑𝑖𝑛𝑖 時刻 𝑡 における生存関数 (b𝑆(𝑡)) は、寿命 (スポット インスタンスの実行時間) が 𝑡 より長くなる確率として定義されます。𝑛𝑖 は、時刻 𝑡𝑖 までに生き残った (実行中のスポット インスタンス) 数であり、𝑑𝑖 は、時刻 𝑡𝑖 における死亡数 (スポット インスタンスの中断) を意味します。図 6 は、異なるスポット インスタンス データセットとベンダー別にグループ化された Kaplan-Meier 推定量の分布を比較しています。図では、横軸がスポットインスタンスの実行時間（生存時間）、縦軸が分布を示しています。図6aは、AWS、GCP、Azureのb𝑆（𝑡）を比較しています。黄色の実線、緑の破線、青の点線は、それぞれAWS、GCP、Azureの分布を示しています。図から、AWSが最も低い生存率を示し、次にGCP、Azureの順になっていることがわかります。AWSスポットインスタンスの平均実行時間は1.2時間で、24時間の実験中、GCPとAzureのインスタンスの半分以上が中断を経験しませんでした。AWS、GCP、Azureの最短の𝑃90実行時間は、それぞれ0.02、0.5、5時間です。次に、さまざまなスポットインスタンスデータセットと中断イベントの相関を評価します（RQ-2）。図 6b は、異なる割り込みなしスコアに関する生存時間の分布を比較し、図 6c は SPS スコアに関して比較しています。どちらの図も、異なるスポットインスタンスデータセットでグループ化された AWS 実験結果です。どちらのデータセットでも、スコアが高いほど可用性が高いことを意味します。低 (1.0)、中 (2.0)、高 (3.0) のスコアは、それぞれ実線、破線、点線で示されています。どちらの図からも、スコア値が高いほど、スコア値が低い場合よりも生存率が高いことがわかります。節約額の数値と Azure の割り込みなしスコアは、AWS の割り込みなしスコアや SPS のような顕著なパターンを示さないため、省略しています。図 7 は、スポットインスタンスの中断が始まってからノードが再び満たされるまでの経過時間を比較しています。時間が短いということは、中断が発生した直後にスポットインスタンスが再び利用可能になることを意味し、可用性が高いことを意味します。サブ図は、スポットインスタンスデータセットに従ってインスタンスをグループ化しています。各図で、黄色の実線、青の点線、緑の破線はそれぞれ AWS、Azure、GCP の結果を示しています。各行には、分類後の高値には △、低値には ▽ の記号が付けられています。コスト削減率データセット (図 7a) は、AWS、Azure、GCP のすべてで、高値と低値の間に目立った違いは見られません。GCP と Azure は同様のレイテンシ分布を示していますが、AWS の可用性は他よりもはるかに低くなっています。中断なしスコア (図 7b) に関しては、Azure は高値と低値の間に異なるパターンは見られませんでしたが、AWS は宣伝されているスコアに従う明確なパターンを示しています。AWS スポットインスタンスの高中断なしスコアは、中断後のフルフィルメント時間が速いことを示しています。即時可用性データ（図7c）は、高と低の間に目立った違いがなく、SPS値が高いほど中断後の履行の待ち時間が短く（可用性が高い）、宣伝されているスコア特性によく従っていることを示しています。

### 5.2 SPS 予測の有効性
AWS SPS データセットによって提供されるスポットインスタンスの即時可用性データセットは、スポットインスタンスの中断イベントと可用性をモデル化するために有益であることがわかりました。さらに一歩進んで、将来の SPS 値を予測することでスポットインスタンスの中断を予測する確率を高めることができるかどうかという RQ-3 に答えるために、図 8 でスポットインスタンスの中断の分布をさまざまな予測 SPS 値と比較します。縦軸は分布を示し、横軸はスポットインスタンスの実行 (生存) 時間を示します。図 8a は、スポットインスタンスのリクエストが行われたときに SPS 値が高い (3.0) スポットインスタンスの存続時間を示しています。SPS 値は実験の過程で変化する可能性があり、予測 SPS 値を 0.5 のビンサイズで分類します。点線は、平均予測SPS値が3.0の場合を示しており、これはSPS値が高値で一定に保たれると予想されることを意味します。一点鎖線は、平均予測SPS値が2.5より高く3.0より低い場合を示しています。他の線も同様に表されています。図から、初期のSPS値が3.0と高値であっても、将来のSPS値が不明瞭な場合、スポットインスタンスの信頼性に重​​大な影響を与える可能性があることがわかります。例えば、予測SPSが高い場合のスポットインスタンスの平均生存時間は22時間ですが、予測SPS値が低い場合の中央値は16時間です。図 8b は、初期 SPS 値が低い (1.0) スポットインスタンスの生存時間を示しています。同様に、SPS 値は変動することがあるため、予測 SPS 値ごとにインスタンスをグループ化して実行時間を示しています。実線は、SPS 値が 1.0 で低いままになると予想される場合を示しており、実行時間が非常に短いことがわかります。それ以外の場合は、初期 SPS 値が低くても、予測 SPS 値が高いインスタンスの方が生存時間が長くなります。たとえば、SPS が一貫して 1.0 になると予想されるスポットインスタンスの平均実行時間は 0 時間ですが、SPS が 2.0 から 2.5 の間になると予想されるスポットインスタンスの平均実行時間は 8 時間であることがわかります。この結果は、ユーザーのスポットインスタンスタイプのリストが限られていて、GPU インスタンスなどの初期 SPS が低い場合に特に役立ちます。その場合、SPSを予測することで、現在のSPSが低い場合でも、スポットインスタンスの信頼性を大幅に向上させることができます。スポットインスタンスを選択する際に、予測されたSPS値を参照することで、信頼性を大幅に向上させることができます。このアプローチは、スポットインスタンスの中断イベントを直接予測しようとした先行研究と比較して独特です。Azure研究者[54]による研究では、スポットインスタンスの内部中断ログを使用し、優れた予測性能を示しました。しかし、データセットは公開されておらず、公開研究には限界があります。SpotLake[31]で発表された研究では、中断実験のログを用いてランダムフォレスト[8]を用いてスポットインスタンスの中断イベントをモデル化しようとしましたが、実験コストが法外な十分なトレーニングデータがないため、予測性能が低下しました。この提案されたアプローチは、内部情報を必要とせずに、低予算でスポットインスタンスの信頼性を向上させることができます。まとめると、前述の研究課題に対する回答は以下のように示されます。
RQ-1 主要パブリックベンダーが提供するスポットインスタンスのうち、中断に関して最も信頼性が高いのはどのベンダーですか？ 回答：Azureスポットインスタンスが最も信頼性が高く、次いでGCPとAWSが続きました。
RQ-2 多くのスポットインスタンスデータセットの中で、スポットインスタンスの中断と最も相関性の高いデータセットはどれですか？ 回答：AWSSPSデータセットは、スポットインスタンスの中断と最も高い相関を示しています。コスト削減と中断なしスコアは、AWS SPSほど高い相関を示していません。
RQ-3 SPS値の予測は、スポットインスタンスの中断の可能性を低減できますか？ 回答：はい。SPSデータセットの予測は、スポットインスタンスの信頼性の向上に確実に役立ちます。初期のSPS値が高い場合、予測値が一貫して高いインスタンスを選択すると、スポットインスタンスの予想実行時間が63.2%増加する可能性があります。初期のSPS値が低い場合でも、期待されるSPS値が高いスポットインスタンスを選択すると、スポットインスタンスの期待実行時間が168%増加する可能性があります。
全体的に見ると、AzureとGCPが提供するスポットインスタンスのデータセットは、適切なインスタンスタイプを選択する際にあまり役に立ちません。しかしながら、AzureとGCPのスポットインスタンスの信頼性は比較的高く、インスタンスの選択に関わらず、ユーザーは中断を経験する可能性があります。AWSが提供するスポットインスタンスは中断が最も多くなっています。しかし、AWSが提供するスポットインスタンスのデータセットは、スポットインスタンスの中断を非常によく反映しています。したがって、AzureやGCPとは異なり、AWSのスポットインスタンスを使用する場合は、信頼性の高い実行のために適切なインスタンスタイプを選択するよう、より慎重になる必要があります。

## 6 関連研究 
スポットインスタンスデータセットのモデリングと利用：スポットインスタンスの登場以来、スポット価格データセットは広く利用され、スポットインスタンスの信頼性を高めるために分析されてきました。スポットインスタンスの価格データセットの特徴を明らかにし、その分析をスポットインスタンスの中断に関連付けることで中断の可能性を低減する試みがなされてきました [13, 21, 33, 36, 40, 40, 51, 52]。スポット価格と分析結果を用いて、Ali-EldinらはWebサーバーを展開することを提案しました [2]。Sonらは、スポット価格と分析結果を用いてWebサーバーを展開することを提案しました [3]。 DNN学習タスクには、世界中に配置されたGPUスポットインスタンスを用いたDeepSpotCloud [30]が提案されている。ビッグデータ処理には、Hadoop [16]用のSeeSpotRun [11]、Apache Spark [58]用のMapReduce [12]、Flint [43]、Tr-Spark [53]が提案されている。オンラインWebサービス [2, 19]、バッチ処理ジョブ [34, 45]、独立タスクの並列処理 [49] などが提案されており、一時的なサーバーによるストラグラー効果 [4] を軽減している。前述の研究はスポット価格データセットに依存していましたが、スポットインスタンスの運用変更によりその研究は時代遅れとなりました[6, 20]。本論文の知見は、スポット価格データセットに依存せずに瞬間的な可用性を予測することで、スポットインスタンスの信頼性を向上させる新たな機会を提供します。スポットインスタンスの価格予測: スポットインスタンスの瞬時可用性データセットは、適切なパフォーマンスを持つ機械学習分類モデルを使用して予測可能であることを示しました。この研究以前にも、スポット価格の値を予測して将来のコスト削減と中断イベントを予測する試みがありました。Khandelwalら[25]はランダムフォレストを使用し、Fabraら[15]はディープニューラルネットモデルを使用し、Alkharifら[3]は価格予測に時系列分析のさまざまな統計的手法を使用しました。スポット価格運用ポリシーの変更により[6,20]、以前の研究は時代遅れになり、この論文のような新しいアプローチを提供する必要があります。
スポットインスタンスの中断の分析: スポット価格データセットの分析と比較して、スポットインスタンスの中断とスポットインスタンスデータセットとの相関の分析と実験はあまり行われていませんでした。Phamら[39]とLeeら[40]はスポットインスタンスの中断をスポットインスタンスデータセットと相関させる実験を研究しました。 [ 31 ] は、AWS インスタンスのみを対象にスポットインスタンスの中断実験を行い、中断パターンを分析しました。Azure については、Yang ら [ 54 ] が Azure の内部で利用可能な中断トレースを活用し、Transformer モデルに基づくインスタンス中断予測モデルを用いることを提案しました。GCP については、Haugerud ら [ 18 ] と Kadupitiya ら [ 23 ] が中断テストを実施し、動作をモデル化しました。著者らの知る限りでは、本論文は AWS、Azure、GCP の主要ベンダー 3 社を対象にスポットインスタンスの中断実験を行った初の研究です。スポットインスタンスの挙動を比較することで、広く採用されていると考えられるマルチクラウド環境でユーザーが最も適切なスポットインスタンスを選択するのに大いに役立ちます [9, 38, 56]。

## 7 結論
クラウドスポットインスタンスは、突然のインスタンス終了のリスクがあるクラウドリソースを使用する場合に、大幅なコスト削減を提供します。ユーザーがスポットインスタンスをより良く使用できるように、パブリックサービスベンダーは、価格、過去の期間の中断率、瞬間的な可用性情報など、さまざまなスポットインスタンスデータセットを提供しています。公開されている情報が多様であるにもかかわらず、スポットインスタンスの中断や信頼性とは無関係なスポット価格データセットを除いて、広く使用も分析もされていません。この問題に対処するために、本稿では、さまざまなスポットインスタンスデータセットの特性を徹底的に分析し、信頼性を高めるために瞬間的な可用性データセットを予測するモデルを提案します。公開されているデータセットとスポットインスタンスの中断の動作の関係を明らかにするために、AWS、Azure、およびGCPクラウドでスポットインスタンスの中断に関する実際の実験を行いました。その結果、Azureスポットインスタンスが最も高い信頼性を示し、次にGCP、AWSの順であることがわかりました。 AWSの信頼性は最も低かったものの、AWSが提供するインスタント可用性データセットは、AzureやGCPが提供するデータセットでは予測できなかった、近い将来の中断イベントの予測に役立つことがわかりました。さらに、提案されたインスタント可用性スコア予測を用いることで、スポットインスタンスの平均実行時間は、初期スコアが高いインスタンスでは63.2%、初期スコアが低いスポットインスタンスでは168%向上することが示されました。本研究により、ユーザーはクラウドリソースをより効率的に利用し、コスト削減と信頼性の向上を実現し、システム全体のパフォーマンスを最適化できるようになると考えています。